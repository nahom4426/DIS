import{Z as U,aH as _,r,j as I,k as N,m as p,o as u,w as h,d as w,N as P,a as x,c as v,n as B,t as E,u as k,b as m,M as D,aJ as M,T as b,_ as S}from"./index-BA4ml571.js";import{I as C}from"./InsuredMemberForm-BPyVVZqT.js";const F={class:"bg-white rounded-lg"},A={key:0,class:"p-4 mb-4 text-sm text-red-700 bg-red-100 rounded-lg"},j={key:1,class:"p-4 mb-4 text-sm text-yellow-700 bg-yellow-100 rounded-lg"},O=U({__name:"EditInsured.mdl",props:{data:{type:Object,required:!0,default:()=>({})}},setup(y){const d=y,g=_(),s=r(""),l=r(!1),t=r({}),a=r("");I(()=>{console.log("EditInsured modal mounted with data prop:",d.data),d.data&&(a.value=d.data.insuredUuid||"",t.value=d.data.insured||{},console.log("Extracted insured UUID:",a.value),console.log("Extracted insured data:",t.value))}),N(()=>d.data,e=>{e&&(console.log("Data prop updated:",e),a.value=e.insuredUuid||"",t.value=e.insured||{})},{deep:!0});async function f(e){try{if(l.value=!0,s.value="",!a.value)throw new Error("Insured UUID is missing");const o=new FormData;e.employeePhoto&&o.append("photo",e.employeePhoto);const c={firstName:e.firstName,payerUuid:e.payerUuid,fatherName:e.fatherName,grandFatherName:e.grandFatherName||e.grandfatherName,birthDate:e.birthDate?`${e.birthDate}T00:00:00.000Z`:"",phone:`${e.phone}`,woreda:e.woreda||"",subcity:e.subcity||"",city:e.city||"",state:e.state||"Addis Ababa",country:e.country||"Ethiopia",idNumber:e.idNumber,position:e.position,gender:e.gender,status:e.status||"ACTIVE",email:e.email||"",insuredUuid:a.value};e.employeePhoto||(t.value.photoBase64?c.photoBase64=t.value.photoBase64:t.value.photoPath&&(c.photoPath=t.value.photoPath)),o.append("insured",JSON.stringify(c));const n=await M(a.value,o);if(n&&(n.success||n.status===200||n.status==="success")){const i={...t.value,...e,insuredUuid:a.value};e.employeePhoto||(t.value.photoBase64&&(i.photoBase64=t.value.photoBase64),t.value.photoPath&&(i.photoPath=t.value.photoPath),t.value.photoUrl&&(i.photoUrl=t.value.photoUrl)),g.update(a.value,i),b(!0,"Insured member updated successfully"),d.data.onUpdated&&typeof d.data.onUpdated=="function"&&d.data.onUpdated(i),m()}}catch(o){console.error("Update error:",o),s.value=o.message||"An error occurred while updating insured member",b(!1,"Failed to update insured member",s.value)}finally{l.value=!1}}return(e,o)=>(u(),p(D,null,{default:h(()=>[w(P,{class:"",size:"lg",title:"Edit Insured Member",subtitle:"Update the insured member information in the fields below."},{default:h(()=>[x("div",F,[s.value?(u(),v("div",A,E(s.value),1)):B("",!0),!a.value||Object.keys(t.value).length===0?(u(),v("div",j," Loading insured member data... ")):(u(),p(C,{key:2,"initial-data":t.value,"is-edit":!0,institutionId:t.value.payerUuid,pending:l.value,onSubmit:f,onCancel:()=>k(m)()},null,8,["initial-data","institutionId","pending","onCancel"]))])]),_:1})]),_:1}))}}),$=S(O,[["__scopeId","data-v-df7c5965"]]);export{$ as default};
