import{_ as O,aa as G,b1 as L,r as h,k as Q,j as R,m as q,o as l,w as U,d as J,N as K,a as t,c as i,n as w,E as W,G as X,t as n,F as N,C as M,D as g,e as Y,u as I,b as E,M as Z,T as x,b2 as ee,b3 as te}from"./index-BA4ml571.js";const se={class:"bg-white rounded-lg"},oe={class:"p-4 border-b"},ae={class:"relative"},le={class:"absolute right-3 top-2.5"},ne={key:0,class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},ie={key:1,class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},re={key:0,class:"p-4 bg-blue-50 border-b"},de={class:"flex items-center justify-between"},ce={class:"font-medium text-blue-800"},ue={key:0,class:"ml-2 text-blue-600"},pe=["disabled"],he={class:"flex-1 overflow-hidden flex flex-col"},fe={class:"overflow-y-auto",style:{height:"calc(70vh - 180px)"}},ge={class:"min-w-full divide-y divide-gray-200"},xe={class:"bg-white divide-y divide-gray-200"},ye={class:"px-6 py-4 whitespace-nowrap"},_e=["checked","onChange"],ve={class:"px-6 py-4 whitespace-nowrap"},be={class:"flex items-center"},me={class:"flex-shrink-0 h-10 w-10 rounded-full overflow-hidden border border-gray-200"},we=["src"],ke=["src"],Ue=["src"],Ne={key:3,class:"h-full w-full bg-gray-200 flex items-center justify-center"},Ee={class:"text-xs text-gray-500"},Be={class:"ml-4"},Ce={class:"text-sm font-medium text-gray-900"},Pe={class:"text-sm text-gray-500"},Ae={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},De={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Fe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Me={class:"px-6 py-4 whitespace-nowrap text-sm font-bold"},Ie={class:"px-6 py-4 whitespace-nowrap pl-10"},Se=["checked","onChange","disabled"],Te={class:"px-6 py-4 whitespace-nowrap pl-2"},je={class:"flex items-center"},$e={class:"flex-shrink-0 h-10 w-10 rounded-full overflow-hidden border border-gray-200"},Ve=["src"],ze={key:1,class:"h-full w-full bg-blue-100 flex items-center justify-center"},He={class:"text-xs text-blue-600"},Oe={class:"ml-4"},Ge={class:"text-sm font-medium text-gray-900"},Le={class:"text-sm text-gray-500"},Qe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Re={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},qe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Je={class:"px-6 py-4 whitespace-nowrap text-sm font-bold"},Ke={key:1},We={colspan:"6",class:"px-6 py-4 text-center text-gray-500"},Xe={class:"flex justify-end gap-2 w-full p-4 border-t"},Ye=["disabled"],Ze={__name:"AddEmployeeModal.mdl",emits:["membersAdded"],setup(et,{emit:S}){var D,F;const T=S,j=G(),k=L().params.contractHeaderUuid,B=h(((F=(D=j.auth)==null?void 0:D.user)==null?void 0:F.payerUuid)||""),y=h(""),p=h(!1),_=h([]),d=h([]),c=h({});function v(o){const s=o.target;s.src="/assets/placeholder-profile.png"}function $(){return"http://localhost:8080/api"}const b=async()=>{if(!B.value){console.error("Missing payerUuid."),x(!1,"","Payer information missing.");return}if(!k){console.error("Missing contractHeaderUuid."),x(!1,"","Contract information missing.");return}try{p.value=!0;const o=await ee(B.value,{search:y.value,contractUuid:k,page:1,size:10});if(!o||!o.content)throw new Error("Invalid API response structure");const s=o.content.map(e=>{var f;const r=e.fullName||`${e.firstName||""} ${e.fatherName||""} ${e.grandfatherName||""}`.trim(),a={insuredUuid:e.insuredUuid,fullName:r,membershipNumber:e.membershipNumber||e.idNumber||"N/A",idNumber:e.idNumber,phone:e.phone,position:e.position,eligible:e.eligible||e.status==="ACTIVE",isDependant:!1,relationshipType:e.relationshipType||"Employee",profilePictureBase64:e.profilePictureBase64,photoBase64:e.photoBase64,photoUrl:e.photoUrl,photoPath:e.photoPath};return(f=e.dependants)!=null&&f.length&&(a.dependants=e.dependants.map(u=>{const H=u.fullName||`${u.dependantFirstName||""} ${u.dependantFatherName||""} ${u.dependantGrandFatherName||""}`.trim();return{dependantUuid:u.dependantUuid,fullName:H,relationshipType:u.relationship,dependantStatus:u.dependantStatus,profilePictureBase64:u.profilePictureBase64}})),a});_.value=s}catch(o){console.error("Fetch error:",o),_.value=[]}finally{p.value=!1}};let C;Q(y,o=>{clearTimeout(C),(o.length>2||o.length===0)&&(C=setTimeout(b,500))});const V=o=>{const s=d.value.findIndex(e=>e.insuredUuid===o.insuredUuid);s===-1?d.value.push(o):(d.value.splice(s,1),delete c.value[o.insuredUuid])},z=(o,s)=>{c.value[o.insuredUuid]||(c.value[o.insuredUuid]=[]);const e=c.value[o.insuredUuid],r=e.findIndex(a=>a.dependantUuid===s.dependantUuid);r===-1?e.push(s):(e.splice(r,1),e.length===0&&delete c.value[o.insuredUuid])},m=o=>d.value.some(s=>s.insuredUuid===o.insuredUuid),P=(o,s)=>{var e;return(e=c.value[o.insuredUuid])==null?void 0:e.some(r=>r.dependantUuid===s.dependantUuid)},A=async()=>{if(d.value.length===0){x(!1,"","Please select at least one member");return}try{p.value=!0;const o={insuredUuids:d.value.map(e=>e.insuredUuid),dependants:[]};for(const[e,r]of Object.entries(c.value))for(const a of r)o.dependants.push({insuredUuid:e,dependantUuid:a.dependantUuid});const s=await te(k,o);if(s.success){x(!0,"Members added successfully");const e={insuredSummaries:d.value.map(r=>({...r,dependants:c.value[r.insuredUuid]||[],status:"ACTIVE"})),totalInsured:d.value.length,totalDependants:Object.values(c.value).flat().length};T("membersAdded",e),d.value=[],c.value={},await b(),E()}else throw new Error(s.message||"Failed to add members")}catch(o){console.error("Submit error:",o),x(!1,o.message||"Failed to add members")}finally{p.value=!1}};return R(()=>{b()}),(o,s)=>(l(),q(Z,null,{default:U(()=>[J(K,{size:"lg",title:"Add Members to Contract",subtitle:"Search and select members to add to this contract"},{bottom:U(()=>[t("div",Xe,[t("button",{onClick:s[1]||(s[1]=(...e)=>I(E)&&I(E)(...e)),class:"px-4 py-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Back "),t("button",{onClick:A,class:"px-4 py-4 bg-primary text-white rounded-md shadow-sm text-sm font-medium hover:bg-[#014F4F]",disabled:d.value.length===0||p.value}," Continue ",8,Ye)])]),default:U(()=>[t("div",se,[t("div",oe,[t("div",ae,[W(t("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>y.value=e),type:"text",placeholder:"Search by name or membership number...",class:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",onInput:b},null,544),[[X,y.value]]),t("div",le,[p.value?(l(),i("svg",ne,s[2]||(s[2]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(l(),i("svg",ie,s[3]||(s[3]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"},null,-1)])))])])]),d.value.length>0?(l(),i("div",re,[t("div",de,[t("div",null,[t("span",ce,n(d.value.length)+" member(s) selected ",1),Object.keys(c.value).length>0?(l(),i("span",ue," (+"+n(Object.values(c.value).flat().length)+" dependents) ",1)):w("",!0)]),t("button",{onClick:A,class:"px-4 py-2 bg-primary text-white rounded-md hover:bg-[#014F4F] focus:outline-none focus:ring-2",disabled:p.value}," Add Selected ",8,pe)])])):w("",!0),t("div",he,[t("div",fe,[t("table",ge,[s[6]||(s[6]=t("thead",{class:"bg-gray-50 sticky top-0"},[t("tr",null,[t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Select "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Name "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Membership # "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Phone "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Position "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Eligibility ")])],-1)),t("tbody",xe,[_.value.length>0?(l(!0),i(N,{key:0},M(_.value,e=>{var r;return l(),i(N,{key:e.insuredUuid},[e.isDependant?w("",!0):(l(),i("tr",{key:0,class:g(["hover:bg-gray-50",{"bg-gray-50":m(e)}])},[t("td",ye,[t("input",{type:"checkbox",checked:m(e),onChange:a=>V(e),class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,40,_e)]),t("td",ve,[t("div",be,[t("div",me,[e.profilePictureBase64||e.photoBase64?(l(),i("img",{key:0,src:e.profilePictureBase64||e.photoBase64,alt:"Profile",class:"h-full w-full object-cover",onError:v},null,40,we)):e.photoUrl?(l(),i("img",{key:1,src:e.photoUrl,alt:"Profile",class:"h-full w-full object-cover",onError:v},null,40,ke)):e.photoPath?(l(),i("img",{key:2,src:`${$()}/insured/photo/${e.photoPath}`,alt:"Profile",class:"h-full w-full object-cover",onError:v},null,40,Ue)):(l(),i("div",Ne,[t("span",Ee,n((r=e.fullName)==null?void 0:r.split(" ").map(a=>a[0]).join("").toUpperCase()),1)]))]),t("div",Be,[t("div",Ce,n(e.fullName),1),t("div",Pe,n(e.relationshipType||"Employee"),1)])])]),t("td",Ae,n(e.membershipNumber||"N/A"),1),t("td",De,n(e.phone||"N/A"),1),t("td",Fe,n(e.position||"N/A"),1),t("td",Me,[t("span",{class:g(e.eligible?"bg-[#DFF1F1] text-[#02676B] p-1":"text-[#DB2E48] bg-[#DB2E481A] p-1")},n(e.eligible?"Eligible":"Not Eligible"),3)])],2)),e.dependants&&e.dependants.length>0?(l(!0),i(N,{key:1},M(e.dependants,a=>{var f;return l(),i("tr",{key:a.dependantUuid,class:g(["bg-blue-50 hover:bg-blue-100",{"bg-blue-100":P(e,a)}])},[t("td",Ie,[t("input",{type:"checkbox",checked:P(e,a),onChange:u=>z(e,a),disabled:!m(e),class:g(["h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded mr-2",{"opacity-50 cursor-not-allowed":!m(e)}])},null,42,Se)]),t("td",Te,[t("div",je,[t("div",$e,[a.profilePictureBase64?(l(),i("img",{key:0,src:a.profilePictureBase64,alt:"Profile",class:"h-full w-full object-cover",onError:v},null,40,Ve)):(l(),i("div",ze,[t("span",He,n((f=a.fullName)==null?void 0:f.split(" ").map(u=>u[0]).join("").toUpperCase()),1)]))]),t("div",Oe,[s[4]||(s[4]=t("span",{class:"text-blue-600 mr-2"},"â†³",-1)),t("div",null,[t("div",Ge,n(a.fullName),1),t("div",Le,"Dependant ("+n(a.relationshipType)+")",1)])])])]),t("td",Qe,[Y(n(e.membershipNumber||"N/A")+" ",1),s[5]||(s[5]=t("span",{class:"text-xs text-gray-400"},"(Employee ID)",-1))]),t("td",Re,n(e.phone||"N/A"),1),t("td",qe," Dependant ("+n(a.relationshipType)+") ",1),t("td",Je,[t("span",{class:g(a.dependantStatus==="ACTIVE"?"bg-[#DFF1F1] text-[#02676B] p-1":"text-[#DB2E48] bg-[#DB2E481A] p-1")},n(a.dependantStatus==="ACTIVE"?"Eligible":"Not Eligible"),3)])],2)}),128)):w("",!0)],64)}),128)):(l(),i("tr",Ke,[t("td",We,n(p.value?"Loading...":"No members found"),1)]))])])])])])]),_:1})]),_:1}))}},ot=O(Ze,[["__scopeId","data-v-afb22c40"]]);export{ot as default};
