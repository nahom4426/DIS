import{_ as X,aa as Y,h as Z,aH as ee,r as i,c as o,o as l,d as F,w as v,N as te,u as S,a as t,n as x,t as p,D as j,F as g,s as se,aF as V,C as P,B as A,b as E,e as M,m as U,M as le,aP as ae}from"./index-BA4ml571.js";import{r as re,u as oe}from"./xlsx-DLNWaC59.js";const ne={class:"bg-black/50 min-h-full p-6 grid place-items-center"},ie={class:"p-6"},ue={class:"mb-6 text-center"},de={class:"mt-2 text-lg font-semibold text-gray-800"},ce={class:"mb-4"},pe={class:"mt-2 text-sm font-medium text-gray-700 truncate"},me={key:0,class:"my-4 text-center"},ve={key:1,class:"my-4 border rounded-lg"},xe={class:"text-sm font-medium text-gray-700 p-3 bg-gray-50 border-b flex justify-between items-center"},fe={class:"min-w-full divide-y divide-gray-200"},ye={class:"bg-gray-50 sticky top-0 z-10"},ge={class:"bg-white divide-y divide-gray-200"},we={key:3,class:"mb-4"},be={class:"flex justify-between text-sm text-gray-600 mb-1"},he={class:"w-full bg-gray-200 rounded-full h-2.5"},ke={class:"flex justify-between items-center w-full p-4 border-t gap-3"},_e={class:"flex gap-3"},Ce="200px",Ie={__name:"employeeImport.mdl",props:{data:String},setup(L){var N,z;const T=L,$=(z=(N=Y().auth)==null?void 0:N.user)==null?void 0:z.payerUuid,H=Z(),B=ee(),w=i(null),d=i(null),b=i(""),m=i(!1),f=i(0),s=i({type:null,text:null}),h=i(!1),y=i([]),k=i([]),_=i(!1),C=i(!1),I=()=>{f.value=0,m.value=!1,d.value=null,b.value="",s.value={type:null,text:null},h.value=!1,y.value=[],k.value=[],_.value=!1,w.value&&(w.value.value="")},R=async a=>{if(a){C.value=!0;try{const e=await q(a),r=re(e,{type:"array"}),n=r.SheetNames[0],u=r.Sheets[n],c=oe.sheet_to_json(u,{header:1});c.length>0&&(k.value=c[0],y.value=c.slice(1),_.value=!0)}catch(e){console.error("Error parsing file:",e),s.value={type:"error",text:"Could not parse file for preview. Please ensure it's a valid Excel/CSV file."}}finally{C.value=!1}}},q=a=>new Promise((e,r)=>{const n=new FileReader;n.onload=u=>e(u.target.result),n.onerror=u=>r(u),n.readAsArrayBuffer(a)}),G=()=>{if(!d.value){s.value={type:"error",text:"Please select a file first"};return}m.value=!0,f.value=0,s.value={type:null,text:null};const a=new FormData;a.append("file",d.value),H.send(()=>ae({payerUuid:$},a,{onUploadProgress:e=>{f.value=e.total?Math.round(e.loaded*100/e.total):0}}),e=>{var r,n,u;if(m.value=!1,e.success){if(((n=(r=e==null?void 0:e.data)==null?void 0:r.errors)==null?void 0:n.length)>0,s.value={type:"success",text:`Successfully imported ${e.data.successfulImports||0} records`},h.value=!0,(u=e.data)!=null&&u.importedInsured&&Array.isArray(e.data.importedInsured)){console.log("Adding imported data to store:",e.data.importedInsured);const c=B.getAll(),O=[...e.data.importedInsured,...c.filter(Q=>!e.data.importedInsured.some(W=>W.insuredUuid===Q.insuredUuid))];B.setAll(O)}setTimeout(()=>{h.value&&(E(),I())},3500)}else s.value={type:"error",text:e.error||e.message||"Import failed"},console.log("Full API response:",e)})},J=a=>{const e=a.target.files[0];if(!e)return;if(!["text/csv","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(e.type)){s.value={type:"error",text:"Please upload Excel/CSV file"};return}d.value=e,b.value=e.name,s.value={type:null,text:null},R(e)},K=()=>{var a;(a=w.value)==null||a.click()},D=T.data==="dependant"?"Import Dependant Data":"Import Payer Data";return(a,e)=>(l(),o("div",ne,[F(le,{id:"import-modal"},{default:v(()=>[F(te,{size:"mdd",class:"bg-white rounded-lg shadow-xl",title:S(D)},{bottom:v(()=>[t("div",ke,[F(A,{onClick:e[0]||(e[0]=r=>S(E)("import-modal")),class:"border border-gray-300 text-gray-700 hover:bg-gray-50",size:"md"},{default:v(()=>e[11]||(e[11]=[M(" Cancel ")])),_:1,__:[11]}),t("div",_e,[d.value&&!m.value&&s.value.type!=="success"?(l(),U(A,{key:0,onClick:I,class:"border border-gray-300 text-gray-700 hover:bg-gray-50",size:"md"},{default:v(()=>e[12]||(e[12]=[M(" Change File ")])),_:1,__:[12]})):x("",!0),d.value&&!m.value&&s.value.type!=="success"?(l(),U(A,{key:1,onClick:G,class:"bg-blue-600 text-white hover:bg-blue-700",size:"md"},{default:v(()=>e[13]||(e[13]=[M(" Import Now ")])),_:1,__:[13]})):x("",!0)])])]),default:v(()=>[t("div",ie,[t("div",ue,[e[1]||(e[1]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12 mx-auto text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)),t("h2",de,p(S(D)),1),e[2]||(e[2]=t("p",{class:"mt-1 text-sm text-gray-500"},"Upload your Excel or CSV file",-1))]),t("div",ce,[t("div",{onClick:K,class:j(["w-full max-w-md mx-auto border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-blue-400 transition-colors",{"border-blue-400":d.value}])},[d.value?(l(),o(g,{key:1},[e[6]||(e[6]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-10 w-10 mx-auto text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),t("p",pe,p(b.value),1),t("button",{onClick:se(I,["stop"]),class:"mt-2 text-xs text-red-500 hover:text-red-700"}," Remove file ")],64)):(l(),o(g,{key:0},[e[3]||(e[3]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-10 w-10 mx-auto text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)),e[4]||(e[4]=t("p",{class:"mt-2 text-sm text-gray-600"},"Click to select file",-1)),e[5]||(e[5]=t("p",{class:"text-xs text-gray-500 mt-1"},"Excel or CSV files only",-1))],64))],2),t("input",{ref_key:"fileInput",ref:w,type:"file",accept:".csv, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",class:"hidden",onChange:J},null,544)]),C.value?(l(),o("div",me,e[7]||(e[7]=[t("div",{class:"inline-block animate-spin rounded-full h-6 w-6 border-t-2 border-b-2 border-blue-500"},null,-1),t("p",{class:"mt-2 text-sm text-gray-600"},"Loading preview...",-1)]))):x("",!0),_.value&&y.value.length>0?(l(),o("div",ve,[t("div",xe,[t("span",null,"File Preview ("+p(y.value.length)+" rows)",1),e[8]||(e[8]=t("span",{class:"text-xs text-gray-500"},"Scroll to see more rows and columns",-1))]),t("div",{class:"overflow-auto custom-scrollbar",style:V(`max-height: ${Ce}`)},[t("table",fe,[t("thead",ye,[t("tr",null,[(l(!0),o(g,null,P(k.value,(r,n)=>(l(),o("th",{key:n,class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"},p(r),1))),128))])]),t("tbody",ge,[(l(!0),o(g,null,P(y.value,(r,n)=>(l(),o("tr",{key:n},[(l(!0),o(g,null,P(r,(u,c)=>(l(),o("td",{key:c,class:"px-3 py-2 whitespace-nowrap text-xs text-gray-500"},p(u),1))),128))]))),128))])])],4)])):x("",!0),s.value.text?(l(),o("div",{key:2,class:j(["mb-4 p-3 rounded-md text-sm",{"bg-red-50 text-red-700":s.value.type==="error","bg-green-50 text-green-700":s.value.type==="success","bg-blue-50 text-blue-700":!s.value.type}])},p(s.value.text),3)):x("",!0),m.value?(l(),o("div",we,[t("div",be,[e[9]||(e[9]=t("span",null,"Uploading...",-1)),t("span",null,p(f.value)+"%",1)]),t("div",he,[t("div",{class:"bg-blue-600 h-2.5 rounded-full transition-all duration-300",style:V(`width: ${f.value}%`)},null,4)])])):x("",!0),e[10]||(e[10]=t("div",{class:"text-xs text-gray-500 mt-4 text-center"},[t("p",null,"Ensure your file follows the required format."),t("p",{class:"mt-1"},"Max file size: 5MB")],-1))])]),_:1},8,["title"])]),_:1})]))}},Pe=X(Ie,[["__scopeId","data-v-078185d1"]]);export{Pe as default};
