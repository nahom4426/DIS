import{Z as f,r as i,aB as N,j as P,k as E,m as u,o as l,w as y,d as w,N as x,a as C,c as g,n as k,t as B,aD as F,u as L,b as v,M as D,aE as I,T as h,_ as S}from"./index-BA4ml571.js";const j={class:"bg-white rounded-lg"},q={key:0,class:"p-4 mb-4 text-sm text-red-700 bg-red-100 rounded-lg"},O={key:1,class:"p-4 mb-4 text-sm text-yellow-700 bg-yellow-100 rounded-lg"},R=f({__name:"EditPayer.mdl",props:{data:{type:Object,required:!0,default:()=>({})}},setup(m){const t=m,r=i(""),p=i(!1),a=i({}),o=i(""),_=N();function b(e){return e.replace(/^(\+\d{3})0/,"$1")}P(()=>{console.log("EditPayer modal mounted with data prop:",t.data),t.data&&(o.value=t.data.payerUuid||t.data.institutionUuid||"",a.value=t.data.payer||t.data.institution||{},console.log("Extracted payer UUID:",o.value),console.log("Extracted payer data:",a.value))}),E(()=>t.data,e=>{e&&(console.log("Data prop updated:",e),o.value=e.payerUuid||e.institutionUuid||"",a.value=e.payer||e.institution||{})},{deep:!0});async function U(e){try{if(p.value=!0,r.value="",console.log("Received form values:",e),!o.value)throw new Error("Payer UUID is missing");const n=new FormData,c={payerName:e.payerName||"",tinNumber:e.tinNumber||0,dependantCoverage:e.dependantCoverage,description:e.description||e.memo||"",email:e.email,telephone:b(e.telephone),category:e.category||"",address1:e.address1||"",address2:e.address2||"",address3:e.address3||"",state:e.state||"Ethiopia",country:e.country||"Ethiopia",latitude:0,longitude:0,referralType:"",referredBy:"",status:"ACTIVE"};console.log("Constructed payerRequestObj:",c),n.append("payerRequest",JSON.stringify(c)),e.payerLogo?(console.log("Appending logo file to FormData:",e.payerLogo),n.append("logo",e.payerLogo)):(console.log("No new logo file to append"),n.append("logo",new Blob([],{type:"application/octet-stream"})));for(const d of n.entries())console.log(`FormData contains: ${d[0]}: ${d[1]}`);console.log("Submitting FormData with payerRequest:",c),console.log("Logo included:",e.payerLogo?"Yes":"No");const s=await I(o.value,n);if(s!=null&&s.success){const d={...a.value,...e,payerUuid:o.value};e.payerLogo&&(d.logoBase64=null,d.logoPath=s.logoPath||a.value.logoPath,d.logoUrl=s.logoUrl||a.value.logoUrl),_.update(o.value,d),h(!0,"Payer updated successfully"),t.data.onUpdated&&t.data.onUpdated(d),v()}}catch(n){console.error("Update error:",n),h(!1,"Failed to update payer",r.value)}finally{p.value=!1}}return(e,n)=>(l(),u(D,null,{default:y(()=>[w(x,{class:"",size:"lg",title:"Edit Payer",subtitle:"Update the payer information in the fields below."},{default:y(()=>[C("div",j,[r.value?(l(),g("div",q,B(r.value),1)):k("",!0),!o.value||Object.keys(a.value).length===0?(l(),g("div",O," Loading payer data... ")):(l(),u(F,{key:2,"initial-data":a.value,"is-edit":!0,pending:p.value,onSubmit:U,onCancel:()=>L(v)()},null,8,["initial-data","pending","onCancel"]))])]),_:1})]),_:1}))}}),T=S(R,[["__scopeId","data-v-d4dc891a"]]);export{T as default};
