import{_ as J,a8 as b,g as K,h as Q,r as c,k as W,j as X,m as Z,o as r,w as S,d as x,N as ee,a as t,c as o,F as N,C as R,D as A,t as g,Y as te,S as se,n as _,E as V,b9 as B,B as F,u as P,b as L,e as M,M as ae,ba as le,T as re}from"./index-BA4ml571.js";const oe={class:"space-y-4"},ne={class:"grid grid-cols-2 border border-base-clr rounded w-full"},ie=["onClick"],ce={class:"relative"},ue={key:0,class:"flex justify-center items-center h-40"},de={key:1,class:"overflow-y-auto max-h-96"},me={class:"flex justify-between items-center mb-2"},ge={key:0,class:"flex items-center"},pe={class:"min-w-full divide-y divide-gray-200"},ve={class:"bg-white divide-y divide-gray-200"},fe={class:"px-6 py-4 whitespace-nowrap"},xe=["checked","onChange"],ye={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},he={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},we={key:0},be={key:2,class:"overflow-y-auto max-h-96"},Se={class:"flex justify-between items-center mb-2"},_e={key:0,class:"flex items-center"},ke={class:"min-w-full divide-y divide-gray-200"},De={class:"bg-white divide-y divide-gray-200"},Ce={class:"px-6 py-4 whitespace-nowrap"},Ue=["checked","onChange"],Ne={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Re={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ae={key:0},Te={class:"flex justify-end gap-4 pt-8"},Ie={__name:"RemoveServiceToContract.mdl",props:{data:{type:Object,required:!0,default:()=>({})}},setup(j){async function $(a,e){return console.log(`Attempting to unassign items from group ${a}:`,e),new Promise(s=>{setTimeout(()=>{e.length>0?s({success:!0,message:"Items unassigned successfully (mock)"}):s({success:!1,message:"No items selected for unassignment (mock)"})},1e3)})}const k=j,y=b(()=>{var a,e;return(e=(a=k.data)==null?void 0:a.data)==null?void 0:e.groupUuid}),D=b(()=>{var a,e;return(e=(a=k.data)==null?void 0:a.data)==null?void 0:e.contractHeaderUuid});console.log("RemoveServicesModal mounted with props:",k);const{addToast:h}=K(),G=Q(),u=c(0),z=[{name:"Services",value:0},{name:"Drugs",value:1}],p=c([]),v=c([]),m=c(""),n=c([]),i=c([]),w=c(!0),d=c(!1);W(u,a=>{d.value=!1});async function q(){try{if(w.value=!0,!y.value||!D.value){console.warn("UUIDs not available for fetching assigned items."),w.value=!1;return}const s=((await le(y.value,D.value)).data||[]).map(l=>{let f=null;return l.serviceName!==null?f="SERVICE":l.drugName!==null&&(f="DRUG"),{...l,itemType:f}}).filter(l=>l.itemType!==null);p.value=s.filter(l=>l.itemType==="SERVICE"),v.value=s.filter(l=>l.itemType==="DRUG"),n.value=[],i.value=[]}catch(a){console.error("Error fetching assigned services and drugs:",a),re(!1,"Failed to load assigned services and drugs")}finally{w.value=!1}}const T=b(()=>{if(!m.value)return p.value;const a=m.value.toLowerCase();return p.value.filter(e=>(e.serviceName||"").toLowerCase().includes(a))}),I=b(()=>{if(!m.value)return v.value;const a=m.value.toLowerCase();return v.value.filter(e=>(e.drugName||"").toLowerCase().includes(a))});function E(){u.value===0?d.value?n.value=[...p.value]:n.value=[]:d.value?i.value=[...v.value]:i.value=[]}function H(a){const e=n.value.findIndex(s=>s.contractDetailUuid===a.contractDetailUuid);e>-1?n.value.splice(e,1):n.value.push(a)}function O(a){const e=i.value.findIndex(s=>s.contractDetailUuid===a.contractDetailUuid);e>-1?i.value.splice(e,1):i.value.push(a)}function C(a){return n.value.some(e=>e.contractDetailUuid===a.contractDetailUuid)}function U(a){return i.value.some(e=>e.contractDetailUuid===a.contractDetailUuid)}async function Y(){try{if(!y.value||!D.value){h({type:"error",title:"Error",message:"Missing group or contract UUIDs to remove items."});return}const a=[...n.value.map(s=>s.contractDetailUuid),...i.value.map(s=>s.contractDetailUuid)].filter(Boolean);if(a.length===0){h({type:"info",title:"No Selection",message:"Please select items to remove."});return}const e=await $(y.value,a);if(e.success)h({type:"success",title:"Success",message:"Items removed from contract successfully"}),L(!0);else throw new Error(e.message||"Failed to remove items")}catch(a){console.error("Error removing items:",a),h({type:"error",title:"Error",message:a.message||"Failed to remove items from contract"})}}return X(()=>{q()}),(a,e)=>(r(),Z(ae,null,{default:S(()=>[x(ee,{size:"lg",title:"Remove Services/Drugs from Contract",subtitle:"Select services or drugs to remove from this contract"},{default:S(()=>[t("div",oe,[t("div",ne,[(r(),o(N,null,R(z,s=>t("div",{key:s.value,onClick:l=>u.value=s.value,class:A(["px-4 py-3 transition-colors text-center cursor-pointer duration-300",u.value===s.value?s.value===0?"bg-base-clr text-white rounded-l font-medium":"bg-base-clr text-white rounded-r font-medium":""])},g(s.name),11,ie)),64))]),t("div",ce,[x(te,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=s=>m.value=s),placeholder:u.value===0?"Search assigned services...":"Search assigned drugs...",attributes:{"icon-left":"search",class:"pl-10"}},null,8,["modelValue","placeholder"]),e[3]||(e[3]=t("div",{class:"absolute left-3 top-3 text-gray-400"},[t("i",{class:"fas fa-search"})],-1))]),w.value?(r(),o("div",ue,[x(se,{size:"lg"})])):u.value===0?(r(),o("div",de,[t("div",me,[e[5]||(e[5]=t("h3",{class:"font-medium"},"Assigned Services",-1)),p.value.length>0?(r(),o("div",ge,[V(t("input",{type:"checkbox",id:"selectAllServicesRemoval","onUpdate:modelValue":e[1]||(e[1]=s=>d.value=s),onChange:E,class:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"},null,544),[[B,d.value]]),e[4]||(e[4]=t("label",{for:"selectAllServicesRemoval",class:"ml-2 text-sm text-gray-700"},"Select All for Removal",-1))])):_("",!0)]),t("table",pe,[e[8]||(e[8]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Select "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Service Name "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Price (ETB) "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status ")])],-1)),t("tbody",ve,[(r(!0),o(N,null,R(T.value,s=>{var l;return r(),o("tr",{key:s.contractDetailUuid,class:A({"bg-red-50":C(s),"hover:bg-gray-50":!C(s)})},[t("td",fe,[t("input",{type:"checkbox",checked:C(s),onChange:f=>H(s),class:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"},null,40,xe)]),t("td",ye,g(s.serviceName||"N/A"),1),t("td",he,g(((l=s.negotiatedPrice)==null?void 0:l.toLocaleString("en-US",{minimumFractionDigits:2}))||"0.00"),1),e[6]||(e[6]=t("td",{class:"px-6 py-4 whitespace-nowrap text-sm"},[t("span",{class:"px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800"}," Assigned ")],-1))],2)}),128)),T.value.length===0?(r(),o("tr",we,e[7]||(e[7]=[t("td",{colspan:"4",class:"px-6 py-4 text-center text-sm text-gray-500"}," No services assigned to this group or found matching your search. ",-1)]))):_("",!0)])])])):(r(),o("div",be,[t("div",Se,[e[10]||(e[10]=t("h3",{class:"font-medium"},"Assigned Drugs",-1)),v.value.length>0?(r(),o("div",_e,[V(t("input",{type:"checkbox",id:"selectAllDrugsRemoval","onUpdate:modelValue":e[2]||(e[2]=s=>d.value=s),onChange:E,class:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"},null,544),[[B,d.value]]),e[9]||(e[9]=t("label",{for:"selectAllDrugsRemoval",class:"ml-2 text-sm text-gray-700"},"Select All for Removal",-1))])):_("",!0)]),t("table",ke,[e[13]||(e[13]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Select "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Drug Name "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Price (ETB) "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status ")])],-1)),t("tbody",De,[(r(!0),o(N,null,R(I.value,s=>{var l;return r(),o("tr",{key:s.contractDetailUuid,class:A({"bg-red-50":U(s),"hover:bg-gray-50":!U(s)})},[t("td",Ce,[t("input",{type:"checkbox",checked:U(s),onChange:f=>O(s),class:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"},null,40,Ue)]),t("td",Ne,g(s.drugName||"N/A"),1),t("td",Re,g(((l=s.negotiatedPrice)==null?void 0:l.toLocaleString("en-US",{minimumFractionDigits:2}))||"0.00"),1),e[11]||(e[11]=t("td",{class:"px-6 py-4 whitespace-nowrap text-sm"},[t("span",{class:"px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800"}," Assigned ")],-1))],2)}),128)),I.value.length===0?(r(),o("tr",Ae,e[12]||(e[12]=[t("td",{colspan:"4",class:"px-6 py-4 text-center text-sm text-gray-500"}," No drugs assigned to this group or found matching your search. ",-1)]))):_("",!0)])])])),t("div",Te,[x(F,{onClick:P(L),variant:"outline"},{default:S(()=>e[14]||(e[14]=[M(" Cancel ")])),_:1,__:[14]},8,["onClick"]),x(F,{onClick:Y,pending:P(G).pending.value,class:"text-white py-4 bg-red-600 hover:bg-red-700",disabled:n.value.length===0&&i.value.length===0},{default:S(()=>[M(" Remove Selected "+g(u.value===0?"Services":"Drugs"),1)]),_:1},8,["pending","disabled"])])])]),_:1})]),_:1}))}},Ve=J(Ie,[["__scopeId","data-v-2cd8d74f"]]);export{Ve as default};
