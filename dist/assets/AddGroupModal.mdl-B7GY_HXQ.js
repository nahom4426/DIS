import{Z as z,aa as O,b1 as H,r as h,k as L,j as Q,m as R,o as n,w as N,d as Z,N as q,a as t,c as i,n as b,E as J,G as K,t as l,F as k,C as M,D as f,e as W,u as D,b as U,M as X,T as g,b2 as Y,b3 as ee,_ as te}from"./index-BA4ml571.js";const se={class:"bg-white rounded-lg"},oe={class:"p-4 border-b"},ae={class:"relative"},ne={class:"absolute right-3 top-2.5"},le={key:0,class:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},re={key:1,class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ie={key:0,class:"p-4 bg-blue-50 border-b"},de={class:"flex items-center justify-between"},ce={class:"font-medium text-blue-800"},ue={key:0,class:"ml-2 text-blue-600"},pe=["disabled"],he={class:"flex-1 overflow-hidden flex flex-col"},fe={class:"overflow-y-auto",style:{height:"calc(70vh - 180px)"}},ge={class:"min-w-full divide-y divide-gray-200"},xe={class:"bg-white divide-y divide-gray-200"},_e={class:"px-6 py-4 whitespace-nowrap"},ve=["checked","onChange"],me={class:"px-6 py-4 whitespace-nowrap"},ye={class:"flex items-center"},be={class:"flex-shrink-0 h-10 w-10 rounded-full overflow-hidden border border-gray-200"},we=["src"],Ne=["src"],ke=["src"],Ue={key:3,class:"h-full w-full bg-gray-200 flex items-center justify-center"},Ee={class:"text-xs text-gray-500"},Be={class:"ml-4"},Ce={class:"text-sm font-medium text-gray-900"},Ae={class:"text-sm text-gray-500"},Pe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Fe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Me={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},De={class:"px-6 py-4 whitespace-nowrap text-sm font-bold"},Te={class:"px-6 py-4 whitespace-nowrap pl-10"},Ie=["checked","onChange","disabled"],je={class:"px-6 py-4 whitespace-nowrap pl-2"},Se={class:"flex items-center"},$e={class:"flex-shrink-0 h-10 w-10 rounded-full overflow-hidden border border-gray-200"},Ve=["src"],Ge={key:1,class:"h-full w-full bg-blue-100 flex items-center justify-center"},ze={class:"text-xs text-blue-600"},Oe={class:"ml-4"},He={class:"text-sm font-medium text-gray-900"},Le={class:"text-sm text-gray-500"},Qe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Re={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ze={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},qe={class:"px-6 py-4 whitespace-nowrap text-sm font-bold"},Je={key:1},Ke={colspan:"6",class:"px-6 py-4 text-center text-gray-500"},We={class:"flex justify-between w-full p-4 border-t"},Xe=["disabled"],Ye=z({__name:"AddGroupModal.mdl",emits:["membersAdded"],setup(et,{emit:T}){var P,F;const I=T,j=O(),S=H().params.contractHeaderUuid,E=h(((F=(P=j.auth)==null?void 0:P.user)==null?void 0:F.payerUuid)||""),x=h(""),p=h(!1),_=h([]),u=h([]),c=h({});function v(o){const s=o.target;s.src="/assets/placeholder-profile.png"}function $(){return"http://localhost:8080/api"}const w=async()=>{if(!E.value){console.error("Error: payerUuid is not provided to AddMembersToContractModal."),g(!1,"Failed to load insured members: Payer information missing.");return}try{p.value=!0;const o=await Y(E.value,{search:x.value});if(console.log("📦 Data received from API call:",o),!o||!o.content)throw new Error("Invalid API response structure: Missing content array.");const s=o.content.map(e=>{const d=e.fullName||`${e.firstName||""} ${e.fatherName||""} ${e.grandfatherName||""}`.trim(),a={insuredUuid:e.insuredUuid,fullName:d,firstName:e.firstName,fatherName:e.fatherName,grandfatherName:e.grandfatherName,membershipNumber:e.membershipNumber||e.idNumber||"N/A",idNumber:e.idNumber,phone:e.phone,position:e.position,eligible:e.eligible||e.status==="ACTIVE",isDependant:!1,relationshipType:e.relationshipType||"Employee",profilePictureBase64:e.profilePictureBase64,photoBase64:e.photoBase64,photoUrl:e.photoUrl,photoPath:e.photoPath};return e.dependants&&e.dependants.length>0&&(a.dependants=e.dependants.map(r=>{const y=r.fullName||`${r.dependantFirstName||""} ${r.dependantFatherName||""} ${r.dependantGrandFatherName||""}`.trim();return{dependantUuid:r.dependantUuid,fullName:y,dependantFirstName:r.dependantFirstName,dependantFatherName:r.dependantFatherName,dependantGrandFatherName:r.dependantGrandFatherName,relationshipType:r.relationship,dependantStatus:r.dependantStatus,profilePictureBase64:r.profilePictureBase64}})),a});console.log("👥 Transformed insured members:",s),_.value=s}catch(o){console.error("❌ Error fetching insured members:",o),g(!1,"Failed to load insured members"),_.value=[]}finally{p.value=!1}};let B;L(x,o=>{clearTimeout(B),(o.length>2||o.length===0)&&(B=setTimeout(w,500))});const V=o=>{const s=u.value.findIndex(e=>e.insuredUuid===o.insuredUuid);s===-1?u.value.push(o):(u.value.splice(s,1),delete c.value[o.insuredUuid])},G=(o,s)=>{c.value[o.insuredUuid]||(c.value[o.insuredUuid]=[]);const e=c.value[o.insuredUuid].findIndex(d=>d.dependantUuid===s.dependantUuid);e===-1?c.value[o.insuredUuid].push(s):(c.value[o.insuredUuid].splice(e,1),c.value[o.insuredUuid].length===0&&delete c.value[o.insuredUuid])},m=o=>u.value.some(s=>s.insuredUuid===o.insuredUuid),C=(o,s)=>{var e;return(e=c.value[o.insuredUuid])==null?void 0:e.some(d=>d.dependantUuid===s.dependantUuid)},A=async()=>{if(u.value.length===0){g(!1,"Please select at least one member");return}if(confirm(`Add ${u.value.length} member(s) to contract?`))try{p.value=!0;const s={insuredUuids:u.value.map(d=>d.insuredUuid),dependants:[]};for(const[d,a]of Object.entries(c.value))for(const r of a)s.dependants.push({insuredUuid:d,dependantUuid:r.dependantUuid});const e=await ee(S,s);if(e.success)g(!0,"Members added successfully"),I("membersAdded",{insuredSummaries:u.value.map(d=>({...d,dependants:c.value[d.insuredUuid]||[],status:"ACTIVE"})),totalInsured:u.value.length,totalDependants:Object.values(c.value).flat().length}),U();else throw new Error(e.message||"Failed to add members")}catch(s){console.error("Error:",s),g(!1,s.message||"Failed to add members")}finally{p.value=!1}};return Q(()=>{w()}),(o,s)=>(n(),R(X,null,{default:N(()=>[Z(q,{size:"lg",title:"Add Members to Contract",subtitle:"Search and select members to add to this contract"},{bottom:N(()=>[t("div",We,[t("button",{onClick:s[1]||(s[1]=(...e)=>D(U)&&D(U)(...e)),class:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Back "),t("button",{onClick:A,class:"px-4 py-2 bg-blue-600 text-white rounded-md shadow-sm text-sm font-medium hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:u.value.length===0||p.value}," Continue ",8,Xe)])]),default:N(()=>[t("div",se,[t("div",oe,[t("div",ae,[J(t("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>x.value=e),type:"text",placeholder:"Search by name or membership number...",class:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",onInput:w},null,544),[[K,x.value]]),t("div",ne,[p.value?(n(),i("svg",le,s[2]||(s[2]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(n(),i("svg",re,s[3]||(s[3]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"},null,-1)])))])])]),u.value.length>0?(n(),i("div",ie,[t("div",de,[t("div",null,[t("span",ce,l(u.value.length)+" member(s) selected ",1),Object.keys(c.value).length>0?(n(),i("span",ue," (+"+l(Object.values(c.value).flat().length)+" dependents) ",1)):b("",!0)]),t("button",{onClick:A,class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:p.value}," Add Selected ",8,pe)])])):b("",!0),t("div",he,[t("div",fe,[t("table",ge,[s[6]||(s[6]=t("thead",{class:"bg-gray-50 sticky top-0"},[t("tr",null,[t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Select "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Name "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Membership # "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Phone "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Position "),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Eligibility ")])],-1)),t("tbody",xe,[_.value.length>0?(n(!0),i(k,{key:0},M(_.value,e=>{var d;return n(),i(k,{key:e.insuredUuid},[e.isDependant?b("",!0):(n(),i("tr",{key:0,class:f(["hover:bg-gray-50",{"bg-gray-50":m(e)}])},[t("td",_e,[t("input",{type:"checkbox",checked:m(e),onChange:a=>V(e),class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,40,ve)]),t("td",me,[t("div",ye,[t("div",be,[e.profilePictureBase64||e.photoBase64?(n(),i("img",{key:0,src:e.profilePictureBase64||e.photoBase64,alt:"Profile",class:"h-full w-full object-cover",onError:v},null,40,we)):e.photoUrl?(n(),i("img",{key:1,src:e.photoUrl,alt:"Profile",class:"h-full w-full object-cover",onError:v},null,40,Ne)):e.photoPath?(n(),i("img",{key:2,src:`${$()}/insured/photo/${e.photoPath}`,alt:"Profile",class:"h-full w-full object-cover",onError:v},null,40,ke)):(n(),i("div",Ue,[t("span",Ee,l((d=e.fullName)==null?void 0:d.split(" ").map(a=>a[0]).join("").toUpperCase()),1)]))]),t("div",Be,[t("div",Ce,l(e.fullName),1),t("div",Ae,l(e.relationshipType||"Employee"),1)])])]),t("td",Pe,l(e.membershipNumber||"N/A"),1),t("td",Fe,l(e.phone||"N/A"),1),t("td",Me,l(e.position||"N/A"),1),t("td",De,[t("span",{class:f(e.eligible?"bg-[#DFF1F1] text-[#02676B] p-1":"text-[#DB2E48] bg-[#DB2E481A] p-1")},l(e.eligible?"Eligible":"Not Eligible"),3)])],2)),e.dependants&&e.dependants.length>0?(n(!0),i(k,{key:1},M(e.dependants,a=>{var r;return n(),i("tr",{key:a.dependantUuid,class:f(["bg-blue-50 hover:bg-blue-100",{"bg-blue-100":C(e,a)}])},[t("td",Te,[t("input",{type:"checkbox",checked:C(e,a),onChange:y=>G(e,a),disabled:!m(e),class:f(["h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded mr-2",{"opacity-50 cursor-not-allowed":!m(e)}])},null,42,Ie)]),t("td",je,[t("div",Se,[t("div",$e,[a.profilePictureBase64?(n(),i("img",{key:0,src:a.profilePictureBase64,alt:"Profile",class:"h-full w-full object-cover",onError:v},null,40,Ve)):(n(),i("div",Ge,[t("span",ze,l((r=a.fullName)==null?void 0:r.split(" ").map(y=>y[0]).join("").toUpperCase()),1)]))]),t("div",Oe,[s[4]||(s[4]=t("span",{class:"text-blue-600 mr-2"},"↳",-1)),t("div",null,[t("div",He,l(a.fullName),1),t("div",Le,"Dependant ("+l(a.relationshipType)+")",1)])])])]),t("td",Qe,[W(l(e.membershipNumber||"N/A")+" ",1),s[5]||(s[5]=t("span",{class:"text-xs text-gray-400"},"(Employee ID)",-1))]),t("td",Re,l(e.phone||"N/A"),1),t("td",Ze," Dependant ("+l(a.relationshipType)+") ",1),t("td",qe,[t("span",{class:f(a.dependantStatus==="ACTIVE"?"bg-[#DFF1F1] text-[#02676B] p-1":"text-[#DB2E48] bg-[#DB2E481A] p-1")},l(a.dependantStatus==="ACTIVE"?"Eligible":"Not Eligible"),3)])],2)}),128)):b("",!0)],64)}),128)):(n(),i("tr",Je,[t("td",Ke,l(p.value?"Loading...":"No members found"),1)]))])])])])])]),_:1})]),_:1}))}}),ot=te(Ye,[["__scopeId","data-v-d43fda2d"]]);export{ot as default};
