import{Z as _,a4 as U,r,j as N,k as w,m as c,o as u,w as h,d as P,N as I,a as B,c as v,n as k,t as x,u as E,b as m,M as S,a9 as A,T as b,_ as C}from"./index-BA4ml571.js";import{I as D}from"./authorizationForm-BPBkRnN9.js";const F={class:"bg-white rounded-lg"},M={key:0,class:"p-4 mb-4 text-sm text-red-700 bg-red-100 rounded-lg"},z={key:1,class:"p-4 mb-4 text-sm text-yellow-700 bg-yellow-100 rounded-lg"},j=_({__name:"EditAuthorization.mdl",props:{data:{type:Object,required:!0,default:()=>({})}},setup(y){const o=y,f=U(),s=r(""),l=r(!1),t=r({}),a=r("");N(()=>{o.data&&(a.value=o.data.insuredUuid||"",t.value=o.data.insured||{})}),w(()=>o.data,e=>{e&&(a.value=e.insuredUuid||"",t.value=e.insured||{})},{deep:!0});async function g(e){try{if(l.value=!0,s.value="",!a.value)throw new Error("Insured UUID is missing");const i=new FormData;e.employeePhoto&&i.append("photo",e.employeePhoto);const p={firstName:e.firstName,payerUuid:e.payerUuid,fatherName:e.fatherName,grandFatherName:e.grandFatherName||e.grandfatherName,birthDate:e.birthDate?`${e.birthDate}T00:00:00.000Z`:"",phone:`${e.phone}`,address:e.address||"",state:e.state||"Addis Ababa",country:e.country||"Ethiopia",idNumber:e.idNumber,position:e.position,gender:e.gender,status:e.status||"ACTIVE",email:e.email||"",insuredUuid:a.value};e.employeePhoto||(t.value.photoBase64?p.photoBase64=t.value.photoBase64:t.value.photoPath&&(p.photoPath=t.value.photoPath)),i.append("insured",JSON.stringify(p));const d=await A(a.value,i);if(d&&(d.success||d.status===200||d.status==="success")){const n={...t.value,...e,insuredUuid:a.value};e.employeePhoto||(t.value.photoBase64&&(n.photoBase64=t.value.photoBase64),t.value.photoPath&&(n.photoPath=t.value.photoPath),t.value.photoUrl&&(n.photoUrl=t.value.photoUrl)),f.update(a.value,n),b(!0,"Insured member updated successfully"),o.data.onUpdated&&typeof o.data.onUpdated=="function"&&o.data.onUpdated(n),m()}else throw new Error((d==null?void 0:d.error)||"Update failed")}catch(i){s.value=i.message||"An error occurred while updating insured member",b(!1,"Failed to update insured member",s.value)}finally{l.value=!1}}return(e,i)=>(u(),c(S,null,{default:h(()=>[P(I,{class:"",size:"lg",title:"Edit Insured Member",subtitle:"Update the insured member information in the fields below."},{default:h(()=>[B("div",F,[s.value?(u(),v("div",M,x(s.value),1)):k("",!0),!a.value||Object.keys(t.value).length===0?(u(),v("div",z," Loading insured member data... ")):(u(),c(D,{key:2,"initial-data":t.value,"is-edit":!0,institutionId:t.value.payerUuid,pending:l.value,onSubmit:g,onCancel:()=>E(m)()},null,8,["initial-data","institutionId","pending","onCancel"]))])]),_:1})]),_:1}))}}),$=C(j,[["__scopeId","data-v-22266beb"]]);export{$ as default};
