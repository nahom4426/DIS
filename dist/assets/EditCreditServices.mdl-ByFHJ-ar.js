import{_ as le,r as o,aa as oe,a8 as ne,j as ce,am as we,T as q,k as Z,m as ee,o as g,w as W,c as x,d as D,S as re,F as X,n as M,e as T,a as d,t as y,X as _e,Y,C as de,D as j,B as ue,ad as Ee,s as Ie,P as ke,an as Ce,ao as Se,ap as Fe,b as ae,aq as Ae,ar as Te,Z as qe,al as Be,as as $e,N as Pe,u as Re,M as je,at as Me,au as Oe,av as Ge}from"./index-BA4ml571.js";import{_ as Qe,s as Ke}from"./EmployeeDetails.vue_vue_type_script_setup_true_lang-bllcUb56.js";const We={key:0,class:"flex justify-center p-8"},ze={key:0,class:"py-3 space-y-6"},Le={class:"flex gap-4 mt-4"},Xe={class:"w-72"},Ye={class:"w-full"},Ze={class:"mt-6"},He={key:0,class:"flex justify-center py-8"},Je={key:1,class:"border rounded-lg"},Ve={class:"min-w-full divide-y divide-gray-200"},ea={class:"bg-white divide-y divide-gray-200"},aa={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ta={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},sa={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ia={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},na={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ra={class:"px-6 py-4 whitespace-nowrap text-sm font-bold"},da={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},ua=["onClick","disabled"],la={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 pl-10"},oa={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ca={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 pl-2"},pa={class:"text-xs text-blue-600 ml-1"},va={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ma={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ya={class:"px-6 py-4 whitespace-nowrap text-sm font-bold"},ga={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},ha=["onClick","disabled"],fa={key:0,class:"pt-4 px-6 border-t border-[#DFDEF2] flex justify-end space-x-4"},ba={key:1,class:"py-3 space-y-6"},Ua={class:"grid grid-cols-1 md:grid-cols-3 gap-6 mt-6"},xa={class:"pt-4 px-6 border-t border-[#DFDEF2] flex justify-end space-x-4"},Da={__name:"editCreditServicesForm",props:{dispensingUuid:{type:String,required:!0},onUpdated:{type:Function,default:()=>{}},onCancel:{type:Function,required:!0}},setup(H){var se,ie;const N=H,O=o([]),B=o([]),h=o(null),n=o(null),_=o(""),f=o(""),E=o(""),v=o(!1),U=o(null),t=o("selectEmployee"),u=o("services"),c=o([]),$=o([]),w=o([]),b=o([]),C=o(""),S=o(""),z=oe(),G=o(((ie=(se=z.auth)==null?void 0:se.user)==null?void 0:ie.providerUuid)||""),F=o(""),A=o(""),P=o(new Date().toISOString().split("T")[0]),Q=o(!0),m=o({}),R=o({}),I=ne(()=>n.value?{fullName:n.value.fullName,employeeId:n.value.idNumber,role:n.value.position,phone:n.value.phone,insuredUuid:n.value.insuredUuid,email:n.value.email||"N/A",gender:n.value.gender||"Unknown",address:n.value.address||"Unknown",idNumber:n.value.idNumber,birthDate:n.value.birthDate||"Unknown",status:n.value.status||"UNKNOWN",profilePicture:n.value.profilePictureBase64,isDependant:n.value.isDependant,dependantUuid:n.value.dependantUuid}:null),K=ne(()=>O.value.map(r=>({label:`${r.payerName} (${r.telephone||r.email||"N/A"})`,value:r.payerUuid})));async function p(){var r;try{v.value=!0;const a=await Ce({page:1,limit:100});O.value=(((r=a==null?void 0:a.data)==null?void 0:r.content)||[]).map(e=>({payerUuid:e.payerUuid,payerName:e.payerName||`Unnamed Payer (${e.email})`,email:e.email,telephone:e.telephone})),O.value.length===0&&(U.value="No payers available")}catch(a){console.error("Error fetching payers:",a),U.value="Failed to load payers"}finally{v.value=!1}}async function l(){var r;if(h.value)try{v.value=!0;const a=await Se(h.value,{search:_.value}),e=Array.isArray(a)?a:(a==null?void 0:a.content)||((r=a==null?void 0:a.data)==null?void 0:r.content)||[];B.value=e.flatMap(s=>{var V;const i={insuredUuid:s.insuredUuid,fullName:`${s.firstName||""} ${s.fatherName||""} ${s.grandFatherName||""}`.trim(),phone:s.phone,email:s.email||"N/A",gender:s.gender||"Unknown",address:s.address||"Unknown",eligible:s.status==="ACTIVE",position:s.position||"Unknown position",idNumber:s.idNumber||"N/A",birthDate:s.birthDate||"Unknown",profilePictureBase64:s.profilePictureBase64||null,status:s.status||"UNKNOWN",dependants:s.dependants||[]},J=((V=s.dependants)==null?void 0:V.map(k=>({insuredUuid:k.dependantUuid,fullName:`${k.dependantFirstName||""} ${k.dependantFatherName||""} ${k.dependantGrandFatherName||""}`.trim(),phone:s.phone,email:s.email||"N/A",gender:k.dependantGender||"Unknown",address:s.address||"Unknown",eligible:k.dependantStatus==="ACTIVE",position:`Dependant (${k.relationship})`,idNumber:"N/A",birthDate:k.dependantBirthDate||"Unknown",profilePictureBase64:null,status:k.dependantStatus||"UNKNOWN",isDependant:!0,dependantUuid:k.dependantUuid,employeeUuid:s.insuredUuid})))||[];return[i,...J]}),B.value.length===0&&(U.value="No employees found for this payer")}catch(a){console.error("Error fetching employees:",a),U.value="Failed to load employees"}finally{v.value=!1}}function L(r){r.eligible&&(n.value=r)}function pe(){n.value&&(t.value="selectServices")}async function ve(r){try{v.value=!0;const a=await Ae(G.value,{search:r,page:1,limit:25});c.value=a.data.content.map(e=>{var s;return{id:e.serviceUuid,serviceUuid:e.serviceUuid,serviceCode:e.serviceCode,serviceName:e.serviceName,paymentAmount:`ETB ${((s=e.price)==null?void 0:s.toFixed(2))||"0.00"}`,status:e.status||"UNKNOWN",quantity:1}})}catch(a){console.error("Error fetching services:",a),c.value=[]}finally{v.value=!1}}async function te(r){try{v.value=!0;const a=await Te(G.value,{search:r,page:1,limit:25});$.value=a.data.content.map(e=>({id:e.drugUuid||`temp-${Math.random().toString(36).substr(2,9)}`,drugUuid:e.drugUuid,drugCode:e.drugCode,drugName:e.drugName,price:e.price||0,status:e.status||"UNKNOWN",quantity:1,route:"oral",frequency:"daily",dose:e.dosage||"1",duration:"7 days"}))}catch(a){console.error("Error fetching drugs:",a),$.value=[]}finally{v.value=!1}}function me({type:r,query:a}){r==="services"?ve(a):te(a)}function ye(r){R.value=r}function ge(r){(u.value==="services"?w:b).value.push(r)}function he(r){(u.value==="services"?w:b).value.splice(r,1)}function fe({index:r,value:a}){(u.value==="services"?w:b).value[r].quantity=a}function be({index:r,primaryDiagnosis:a,secondaryDiagnosis:e}){const s=w;a!==void 0&&(s.value[r].primaryDiagnosis=a),e!==void 0&&(s.value[r].secondaryDiagnosis=e)}function Ue({index:r,item:a}){b.value[r]={...b.value[r],...a}}function xe(r){r==="services"?w.value=[]:b.value=[]}function De(){return!h.value||!n.value||!P.value?(U.value="Please fill all required fields",!1):w.value.length>0||b.value.length>0?b.value.some(e=>!e.route||!e.frequency||!e.dose||!e.duration)?(U.value="Please fill all drug administration details",!1):!0:(U.value="Please add at least one service or drug",!1)}async function Ne(){var r,a;if(De())try{v.value=!0;const e={dispensingUuid:N.dispensingUuid,insuredUuid:n.value.isDependant?n.value.employeeUuid:n.value.insuredUuid,dependantUuid:n.value.isDependant?n.value.dependantUuid:null,primaryDiagnosis:C.value,secondaryDiagnosis:S.value,medicationItems:[...w.value.map(i=>({contractDetailUuid:i.serviceUuid,itemType:"SERVICE",remark:i.remark||"",price:typeof i.paymentAmount=="string"?parseFloat(i.paymentAmount.replace("ETB ",""))||0:Number(i.paymentAmount)||0,quantity:Number(i.quantity)||1,primaryDiagnosis:i.primaryDiagnosis||C.value,secondaryDiagnosis:i.secondaryDiagnosis||S.value})),...b.value.map(i=>({contractDetailUuid:i.drugUuid,itemType:"DRUG",remark:i.remark||"",price:i.price||0,quantity:Number(i.quantity)||1,route:i.route||"oral",frequency:i.frequency||"daily",dose:i.dose||"1",duration:i.duration||"7 days",primaryDiagnosis:i.primaryDiagnosis||C.value,secondaryDiagnosis:i.secondaryDiagnosis||S.value}))]},s=await Fe(N.dispensingUuid,e);if(s!=null&&s.success)q(!0,"Success","Claim updated successfully"),N.onUpdated(s.data),ae();else throw new Error((s==null?void 0:s.message)||(s==null?void 0:s.error)||"Update failed without error message")}catch(e){const s=((a=(r=e.response)==null?void 0:r.data)==null?void 0:a.message)||e.message||"Failed to update claim";U.value=s,q(!1,"Error",s)}finally{v.value=!1}}return ce(async()=>{var r;try{Q.value=!0,await p();const a=await we(N.dispensingUuid);if(a.success){if(m.value=a.data,h.value=m.value.payerUuid,P.value=m.value.dispensingDate,F.value=m.value.prescriptionNumber||"",A.value=m.value.pharmacyTransactionId||"",C.value=m.value.primaryDiagnosis||"",S.value=m.value.secondaryDiagnosis||"",m.value.insuredUuid){await l();const e=B.value.find(s=>s.insuredUuid===m.value.insuredUuid||s.isDependant&&s.dependantUuid===m.value.dependantUuid);e&&(n.value=e,t.value="selectServices")}if(m.value.items){for(const e of m.value.items){const s={id:e.itemUuid,remark:e.remark||"",quantity:e.quantity||1,primaryDiagnosis:e.primaryDiagnosis||m.value.primaryDiagnosis||"",secondaryDiagnosis:e.secondaryDiagnosis||m.value.secondaryDiagnosis||""};e.itemType==="SERVICE"?w.value.push({...s,itemType:"SERVICE",serviceUuid:e.itemUuid,serviceCode:e.medicationCode,serviceName:e.medicationName,paymentAmount:`ETB ${((r=e.unitPrice)==null?void 0:r.toFixed(2))||"0.00"}`}):e.itemType==="DRUG"&&b.value.push({...s,itemType:"DRUG",drugUuid:e.itemUuid,drugCode:e.medicationCode,drugName:e.medicationName,price:e.unitPrice||0,route:e.route,frequency:e.frequency,dose:e.dose,duration:e.duration})}w.value.length>0?u.value="services":b.value.length>0&&(u.value="drugs")}}else throw new Error(a.error||"Failed to load claim details")}catch(a){U.value=a.message||"Failed to load claim details",q(!1,"Error",U.value)}finally{Q.value=!1}}),Z(_,()=>{clearTimeout(searchTimeout),searchTimeout=setTimeout(()=>{h.value&&l()},300)}),Z(h,()=>{h.value&&l()}),Z(E,()=>{clearTimeout(drugSearchTimeout),drugSearchTimeout=setTimeout(()=>{E.value.trim().length>0&&te(E.value)},500)}),(r,a)=>(g(),ee(ke,{ref:"formEl",inner:!1,id:"edit-credit-service-form",class:"bg-white rounded-lg shadow-sm",onSubmit:Ie(Ne,["prevent"])},{default:W(({})=>[Q.value?(g(),x("div",We,[D(re,{class:"h-8 w-8 text-teal-600"})])):(g(),x(X,{key:1},[t.value==="selectEmployee"?(g(),x("div",ze,[T(y(U.value)+" ",1),d("div",Le,[d("div",Xe,[D(_e,{obj:!0,name:"payer",label:"Select Payer",validation:"required",options:K.value,disabled:v.value,attributes:{placeholder:"Select a Payer"},modelValue:h.value,"onUpdate:modelValue":a[0]||(a[0]=e=>h.value=e)},null,8,["options","disabled","modelValue"])]),d("div",Ye,[D(Y,{name:"searchEmployeeQuery",label:"Search Employees",attributes:{placeholder:"Search employees"},modelValue:_.value,"onUpdate:modelValue":a[1]||(a[1]=e=>_.value=e)},null,8,["modelValue"])])]),d("div",Ze,[v.value?(g(),x("div",He,[D(re,{class:"h-8 w-8 text-teal-600"})])):(g(),x("div",Je,[d("table",Ve,[a[11]||(a[11]=d("thead",{class:"border-b"},[d("tr",null,[d("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"#"),d("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Employee ID"),d("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Patient Name"),d("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Phone Number"),d("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Position"),d("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Eligibility"),d("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Action")])],-1)),d("tbody",ea,[(g(!0),x(X,null,de(B.value,(e,s)=>(g(),x(X,{key:e.insuredUuid},[e.isDependant?M("",!0):(g(),x("tr",{key:0,class:j({"bg-[#DFF1F1]":n.value&&n.value.insuredUuid===e.insuredUuid,"border-b-2 border-blue-200":e.dependants&&e.dependants.length>0})},[d("td",aa,y(s+1),1),d("td",ta,y(e.idNumber),1),d("td",sa,y(e.fullName),1),d("td",ia,y(e.phone),1),d("td",na,y(e.position),1),d("td",ra,[d("span",{class:j(e.eligible?"bg-[#DFF1F1] text-[#02676B] p-1":"text-[#DB2E48] bg-[#DB2E481A] p-1")},y(e.eligible?"Eligible":"Not Eligible"),3)]),d("td",da,[d("button",{type:"button",onClick:i=>L(e),class:j({"text-white bg-[#02676B] px-4 py-2 hover:bg-teal-900":!(n.value&&n.value.insuredUuid===e.insuredUuid)&&e.eligible,"text-white bg-[#02676B] px-4 py-2 rounded":n.value&&n.value.insuredUuid===e.insuredUuid&&e.eligible,"bg-[#02676B1A] text-white px-4 py-2 cursor-not-allowed":!e.eligible}),disabled:!e.eligible},y(n.value&&n.value.insuredUuid===e.insuredUuid?"Selected":"Select"),11,ua)])],2)),!e.isDependant&&e.dependants&&e.dependants.length>0?(g(!0),x(X,{key:1},de(e.dependants,(i,J)=>(g(),x("tr",{key:i.dependantUuid,class:j(["bg-blue-50",{"bg-blue-100":n.value&&n.value.insuredUuid===i.dependantUuid}])},[d("td",la,[a[9]||(a[9]=d("span",{class:"text-blue-600"},"â†³",-1)),T(" "+y(J+1),1)]),d("td",oa,[T(y(e.idNumber)+" ",1),a[10]||(a[10]=d("span",{class:"text-xs text-gray-400"},"(Employee ID)",-1))]),d("td",ca,[T(y(`${i.dependantFirstName} ${i.dependantFatherName} ${i.dependantGrandFatherName}`.trim())+" ",1),d("span",pa,"(Dependant - "+y(i.relationship)+")",1)]),d("td",va,y(e.phone),1),d("td",ma," Dependant ("+y(i.relationship)+") ",1),d("td",ya,[d("span",{class:j(i.dependantStatus==="ACTIVE"?"bg-[#DFF1F1] text-[#02676B] p-1":"text-[#DB2E48] bg-[#DB2E481A] p-1")},y(i.dependantStatus==="ACTIVE"?"Eligible":"Not Eligible"),3)]),d("td",ga,[d("button",{type:"button",onClick:V=>L({insuredUuid:i.dependantUuid,fullName:`${i.dependantFirstName} ${i.dependantFatherName} ${i.dependantGrandFatherName}`.trim(),phone:e.phone,idNumber:e.idNumber,position:`Dependant (${i.relationship})`,birthDate:i.dependantBirthDate,eligible:i.dependantStatus==="ACTIVE",status:i.dependantStatus,gender:i.dependantGender,email:e.email,address:e.address,isDependant:!0,dependantUuid:i.dependantUuid,employeeUuid:e.insuredUuid}),class:j({"text-white bg-[#02676B] px-4 py-2 hover:bg-teal-900":!(n.value&&n.value.insuredUuid===i.dependantUuid)&&i.dependantStatus==="ACTIVE","text-white bg-[#02676B] px-4 py-2 rounded":n.value&&n.value.insuredUuid===i.dependantUuid&&i.dependantStatus==="ACTIVE","bg-[#02676B1A] text-white px-4 py-2 cursor-not-allowed":i.dependantStatus!=="ACTIVE"}),disabled:i.dependantStatus!=="ACTIVE"},y(n.value&&n.value.insuredUuid===i.dependantUuid?"Selected":"Select"),11,ha)])],2))),128)):M("",!0)],64))),128))])])]))]),n.value?(g(),x("div",fa,[D(ue,{type:"button",onClick:N.onCancel,class:"text-[#75778B] px-6 py-4 border-[1px] border-[#75778B] rounded-lg hover:bg-gray-50",disabled:v.value},{default:W(()=>a[12]||(a[12]=[T(" Cancel ")])),_:1,__:[12]},8,["onClick","disabled"]),d("button",{type:"button",class:"px-6 py-2 bg-primary text-white rounded-md hover:bg-teal-700",onClick:pe}," Continue to Services ")])):M("",!0)])):I.value?(g(),x("div",ba,[T(y(U.value)+" ",1),D(Qe,{employee:I.value},null,8,["employee"]),d("div",Ua,[d("div",null,[D(Y,{modelValue:F.value,"onUpdate:modelValue":a[2]||(a[2]=e=>F.value=e),name:"prescriptionNumber",label:"Prescription Number",validation:"required",attributes:{placeholder:"Enter prescription number"}},null,8,["modelValue"])]),d("div",null,[D(Y,{modelValue:A.value,"onUpdate:modelValue":a[3]||(a[3]=e=>A.value=e),name:"pharmacyTransactionId",label:"Pharmacy Transaction ID",validation:"required",attributes:{placeholder:"Enter pharmacy transaction ID"}},null,8,["modelValue"])]),d("div",null,[D(Y,{modelValue:P.value,"onUpdate:modelValue":a[4]||(a[4]=e=>P.value=e),name:"dispensingDate",label:"Dispensing Date",validation:"required",attributes:{type:"date",placeholder:"Select dispensing date",required:!0}},null,8,["modelValue"])])]),D(Ke,{activeTab:u.value,"onUpdate:activeTab":a[5]||(a[5]=e=>u.value=e),"search-query":u.value==="services"?f.value:E.value,pending:v.value,"available-items":u.value==="services"?c.value:$.value,"added-items":u.value==="services"?w.value:b.value,remarks:R.value,"onUpdate:remarks":ye,"primary-diagnosis":C.value,"secondary-diagnosis":S.value,"onUpdate:searchQuery":a[6]||(a[6]=e=>u.value==="services"?f.value=e:E.value=e),onAddItem:ge,onRemoveItem:he,onUpdateQuantity:fe,onUpdateDiagnosis:be,onUpdateItem:Ue,onSearchItems:me,onClearItems:xe,"onUpdate:primaryDiagnosis":a[7]||(a[7]=e=>C.value=e),"onUpdate:secondaryDiagnosis":a[8]||(a[8]=e=>S.value=e)},null,8,["activeTab","search-query","pending","available-items","added-items","remarks","primary-diagnosis","secondary-diagnosis"]),d("div",xa,[D(ue,{type:"button",onClick:N.onCancel,class:"text-[#75778B] px-6 py-4 border-[1px] border-[#75778B] rounded-lg hover:bg-gray-50",disabled:v.value},{default:W(()=>a[13]||(a[13]=[T(" Cancel ")])),_:1,__:[13]},8,["onClick","disabled"]),D(Ee,{pending:v.value,"btn-text":"Update Claim",class:"bg-primary hover:bg-teal-700 text-white px-6 py-2",disabled:v.value},null,8,["pending","disabled"])])])):M("",!0)],64))]),_:1},512))}},Na=le(Da,[["__scopeId","data-v-887bb701"]]),wa={class:"bg-white rounded-lg"},_a={key:0,class:"p-4 mb-4 text-sm text-red-700 bg-red-100 rounded-lg"},Ea={key:1,class:"p-4 mb-4 text-sm text-blue-700 bg-blue-100 rounded-lg flex items-center gap-2"},Ia=qe({__name:"EditCreditServices.mdl",props:{data:{type:Object,required:!0,default:()=>({})}},setup(H){const N=H,O=oe(),B=Be(),h=o(""),n=o(!1),_=o({}),f=o(""),E=o(!0);async function v(){try{if(E.value=!0,!f.value)return;const t=await Me(f.value);if(t.success){const u=t.data;_.value={payerUuid:u.payerUuid,payerName:u.payerName,insuredUuid:u.insuredUuid,dependantUuid:u.dependantUuid,phone:u.phone,patientName:u.patientName,employeeId:u.employeeId,dispensingDate:u.dispensingDate,prescriptionNumber:u.prescriptionNumber,pharmacyTransactionId:u.pharmacyTransactionId,primaryDiagnosis:u.primaryDiagnosis,secondaryDiagnosis:u.secondaryDiagnosis,type:u.type,medicationItems:u.type==="service"?u.items.map(c=>({serviceUuid:c.serviceUuid,serviceName:c.name,serviceCode:c.code,paymentAmount:`ETB ${c.price.toFixed(2)}`,quantity:c.quantity,remark:c.remark,primaryDiagnosis:c.primaryDiagnosis,secondaryDiagnosis:c.secondaryDiagnosis})):null,drugItems:u.type==="drug"?u.items.map(c=>({drugUuid:c.drugUuid,drugName:c.name,drugCode:c.code,price:c.price,quantity:c.quantity,route:c.route,frequency:c.frequency,dose:c.dose,duration:c.duration,remark:c.remark})):null}}else throw new Error(t.message||"Failed to fetch claim details")}catch(t){console.error("Error fetching claim details:",t),h.value=t.message||"Failed to load claim details",q(!1,"Error",h.value)}finally{E.value=!1}}ce(()=>{N.data&&(f.value=N.data.dispensingUuid||"",f.value&&v())}),Z(()=>N.data,t=>{t&&(f.value=t.dispensingUuid||"",f.value&&v())},{deep:!0});async function U(t){var u,c,$,w,b,C,S,z,G;if(t&&t.isTrusted){console.error("Received raw event instead of form values!");return}try{if(n.value=!0,h.value="",console.log("Received form values:",t),!f.value)throw new Error("Claim UUID is missing");if(!t||typeof t!="object"||Array.isArray(t))throw new Error("Invalid form data received");const A=Object.entries({payerUuid:"Payer",dispensingDate:"Dispensing Date",phone:"Phone Number",patientName:"Patient Name",employeeId:"Employee ID"}).filter(([p])=>{const l=t[p];return l==null||l===""}).map(([p,l])=>l);if(A.length>0)throw new Error(`Missing required fields: ${A.join(", ")}`);const P=((u=t.medicationItems)==null?void 0:u.length)>0,Q=((c=t.drugItems)==null?void 0:c.length)>0;if(!P&&!Q)throw new Error("Please add at least one service or drug item");const m=!!t.dependantUuid,R={providerUuid:((w=($=O.auth)==null?void 0:$.user)==null?void 0:w.providerUuid)||"",payerUuid:t.payerUuid,payerName:t.payerName,insuredUuid:m?null:t.insuredUuid,dependantUuid:m?t.dependantUuid:null,phone:t.phone,patientName:t.patientName,employeeId:t.employeeId,dispensingDate:t.dispensingDate,prescriptionNumber:t.prescriptionNumber||"",pharmacyTransactionId:t.pharmacyTransactionId||"",primaryDiagnosis:t.primaryDiagnosis||"",secondaryDiagnosis:t.secondaryDiagnosis||"",isDependant:m};let I,K;try{if(t.medicationItems){const p={...R,medicationItems:t.medicationItems.map(l=>({serviceUuid:l.serviceUuid,remark:l.remark||"",quantity:Number(l.quantity)||1,paymentAmount:typeof l.paymentAmount=="string"?parseFloat(l.paymentAmount.replace("ETB ",""))||0:Number(l.paymentAmount)||0,primaryDiagnosis:t.primaryDiagnosis||"",secondaryDiagnosis:t.secondaryDiagnosis||""}))};I=await Oe(f.value,p)}else if(t.drugItems){const p={...R,drugItems:t.drugItems.map(l=>({drugUuid:l.drugUuid,quantity:Number(l.quantity)||1,totalPrice:(l.price||0)*(Number(l.quantity)||1),route:l.route||"oral",frequency:l.frequency||"daily",dose:l.dose||"1",duration:l.duration||"7 days",remark:l.remark||""}))};I=await Ge(f.value,p)}else throw new Error("No items added - must have either services or drugs");if(!I)throw new Error("No response received from server");if(I.success)K={...R,invoiceNumber:((b=I.data)==null?void 0:b.invoiceNumber)||_.value.invoiceNumber,dispensingUuid:f.value,totalAmount:t.medicationItems?t.medicationItems.reduce((p,l)=>{const L=typeof l.paymentAmount=="string"?parseFloat(l.paymentAmount.replace("ETB ",""))||0:Number(l.paymentAmount)||0;return p+L*(Number(l.quantity)||1)},0):t.drugItems.reduce((p,l)=>p+(l.price||0)*(Number(l.quantity)||1),0),items:t.medicationItems?t.medicationItems.map(p=>({...p,type:"service",name:p.serviceName,code:p.serviceCode,price:typeof p.paymentAmount=="string"?parseFloat(p.paymentAmount.replace("ETB ",""))||0:Number(p.paymentAmount)||0,remark:p.remark||""})):t.drugItems.map(p=>({...p,type:"drug",name:p.drugName,code:p.drugCode,price:p.price||0}))},B.update(f.value,K),q(!0,"Success","Claim updated successfully"),N.data.onUpdated&&typeof N.data.onUpdated=="function"&&N.data.onUpdated(K),ae();else throw new Error(I.message||((C=I.data)==null?void 0:C.message)||"Update failed without error message")}catch(p){if(((S=p.response)==null?void 0:S.status)===401){q(!1,"Error","Full authentication is required to access this resource");return}throw p}}catch(F){console.error("Update error:",F);const A=((G=(z=F.response)==null?void 0:z.data)==null?void 0:G.message)||F.message||"Failed to update claim";F.value=A,q(!1,"Error",A)}finally{n.value=!1}}return(t,u)=>{const c=$e("Spinner");return g(),ee(je,null,{default:W(()=>[D(Pe,{class:"",size:"xl",title:`Edit Credit ${_.value.type==="service"?"Service":"Drug"}`,subtitle:`Update the credit ${_.value.type==="service"?"service":"drug"} information below.`},{default:W(()=>[d("div",wa,[h.value?(g(),x("div",_a,y(h.value),1)):M("",!0),E.value?(g(),x("div",Ea,[D(c,{class:"h-5 w-5 text-blue-500 animate-spin"}),u[0]||(u[0]=T(" Loading claim details... "))])):!E.value&&Object.keys(_.value).length>0?(g(),ee(Na,{key:2,"initial-data":_.value,"is-edit":!0,pending:n.value,"dispensing-uuid":f.value,onSubmit:U,onCancel:Re(ae)},null,8,["initial-data","pending","dispensing-uuid","onCancel"])):M("",!0)])]),_:1},8,["title","subtitle"])]),_:1})}}}),Sa=le(Ia,[["__scopeId","data-v-28e2a79f"]]);export{Sa as default};
