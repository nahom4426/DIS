import{_ as ee,a8 as x,b1 as te,g as se,h as ae,r as d,j as ie,m as le,o as i,w as D,d as h,N as oe,a as s,c as l,F as N,C as T,D as I,t as v,Y as ne,S as re,n as B,E as ce,b9 as ue,B as H,u as j,b as F,e as $,M as de,ba as ge,bb as pe,T as xe,bc as ve}from"./index-BA4ml571.js";const fe={class:"space-y-4"},me={class:"grid grid-cols-2 border border-base-clr rounded w-full"},ye=["onClick"],he={class:"relative"},be={key:0,class:"flex justify-center items-center h-40"},_e={key:1,class:"overflow-y-auto max-h-96"},we={class:"flex justify-between items-center mb-2"},Se={key:0,class:"flex items-center"},Ee={class:"min-w-full divide-y divide-gray-200"},ke={class:"bg-white divide-y divide-gray-200"},De={class:"px-6 py-4 whitespace-nowrap"},Ue=["checked","onChange","disabled"],Ce={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Ae={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ne={class:"px-6 py-4 whitespace-nowrap text-sm"},Te={key:0,class:"px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800"},Ie={key:1,class:"px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800"},Be={key:0},Fe={key:2,class:"overflow-y-auto max-h-96"},Re={class:"min-w-full divide-y divide-gray-200"},Ve={class:"bg-white divide-y divide-gray-200"},Me={class:"px-6 py-4 whitespace-nowrap"},Le=["checked","onChange","disabled"],Pe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},He={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},je={class:"px-6 py-4 whitespace-nowrap text-sm"},$e={key:0,class:"px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800"},ze={key:1,class:"px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800"},Ge={key:0},qe={class:"flex justify-end gap-4 pt-8"},Oe={__name:"AddServiceToContract.mdl",props:{data:{type:Object,required:!0,default:()=>({})}},setup(z){const U=z,f=x(()=>{var a,e;return(e=(a=U.data)==null?void 0:a.data)==null?void 0:e.groupUuid}),m=x(()=>{var a,e;return(e=(a=U.data)==null?void 0:a.data)==null?void 0:e.contractHeaderUuid});console.log("Resolved groupUuid:",f.value),console.log("Resolved contractHeaderUuid:",m.value),console.log("AddServiceToContract modal mounted with props:",U),te();const{addToast:b}=se(),G=ae(),g=d(0),q=[{name:"Services",value:0},{name:"Drugs",value:1}],y=d([]),_=d([]),w=d([]),S=d([]),p=d(""),r=d([]),c=d([]),E=d(!0),k=d(!1);async function O(){var a;try{if(E.value=!0,!f.value||!m.value){console.warn("UUIDs not available for fetching services."),E.value=!1;return}const t=(await ge(f.value,m.value)).data||[],n=new Map;t.forEach(o=>{n.set(o.contractDetailUuid,{...o,isExisting:!0})});const Z=((a=(await pe(m.value)).data)==null?void 0:a.contractDetails)||[],C=[],A=[];Z.forEach(o=>{const P=n.get(o.contractDetailUuid);o.itemType==="SERVICE"?P?C.push({...o,isExisting:!0}):C.push({...o,isExisting:!1}):o.itemType==="DRUG"&&(P?A.push({...o,isExisting:!0}):A.push({...o,isExisting:!1}))}),y.value=C,_.value=A,w.value=y.value.filter(o=>o.isExisting),S.value=_.value.filter(o=>o.isExisting),r.value=[...w.value],c.value=[...S.value]}catch(e){console.error("Error fetching services and drugs:",e),xe(!1,"Failed to load services and drugs")}finally{E.value=!1}}const R=x(()=>y.value),V=x(()=>_.value);function Y(){g.value===0?k.value?r.value=[...w.value,...y.value.filter(a=>!a.isExisting)]:r.value=w.value:k.value?c.value=[...S.value,..._.value.filter(a=>!a.isExisting)]:c.value=S.value}const M=x(()=>{if(!p.value)return R.value;const a=p.value.toLowerCase();return R.value.filter(e=>(e.serviceName||"").toLowerCase().includes(a))}),L=x(()=>{if(!p.value)return V.value;const a=p.value.toLowerCase();return V.value.filter(e=>(e.drugName||"").toLowerCase().includes(a))});function J(a){const e=r.value.findIndex(t=>t.contractDetailUuid===a.contractDetailUuid);e>-1?r.value.splice(e,1):r.value.push({...a,isExisting:a.isExisting||!1})}function K(a){const e=c.value.findIndex(t=>t.contractDetailUuid===a.contractDetailUuid);e>-1?c.value.splice(e,1):c.value.push({...a,isExisting:a.isExisting||!1})}function Q(a){return r.value.some(e=>e.contractDetailUuid===a.contractDetailUuid)}function W(a){return c.value.some(e=>e.contractDetailUuid===a.contractDetailUuid)}async function X(){try{if(!f.value||!m.value){b({type:"error",title:"Error",message:"Missing group or contract UUIDs to add items."});return}const a=r.value.filter(u=>!u.isExisting).map(u=>u.contractDetailUuid),e=c.value.filter(u=>!u.isExisting).map(u=>u.contractDetailUuid),t=[...a,...e].filter(Boolean);if(t.length===0){b({type:"info",title:"No Changes",message:"No new items selected to add"}),F();return}const n=await ve(f.value,t);if(n.success)b({type:"success",title:"Success",message:"Items added to contract successfully"}),F(!0);else throw new Error(n.message||"Failed to add items")}catch(a){console.error("Error adding items:",a),b({type:"error",title:"Error",message:a.message||"Failed to add items to contract"})}}return ie(()=>{O()}),(a,e)=>(i(),le(de,null,{default:D(()=>[h(oe,{size:"lg",title:"Add Services/Drugs to Contract",subtitle:"Select services or drugs to add to this contract"},{default:D(()=>[s("div",fe,[s("div",me,[(i(),l(N,null,T(q,t=>s("div",{key:t.value,onClick:n=>g.value=t.value,class:I(["px-4 py-3 transition-colors text-center cursor-pointer duration-300",g.value===t.value?t.value===0?"bg-base-clr text-white rounded-l font-medium":"bg-base-clr text-white rounded-r font-medium":""])},v(t.name),11,ye)),64))]),s("div",he,[h(ne,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=t=>p.value=t),placeholder:g.value===0?"Search services...":"Search drugs...",attributes:{"icon-left":"search",class:"pl-10"}},null,8,["modelValue","placeholder"]),e[2]||(e[2]=s("div",{class:"absolute left-3 top-3 text-gray-400"},[s("i",{class:"fas fa-search"})],-1))]),E.value?(i(),l("div",be,[h(re,{size:"lg"})])):g.value===0?(i(),l("div",_e,[s("div",we,[e[4]||(e[4]=s("h3",{class:"font-medium"},"Services",-1)),y.value.length>0?(i(),l("div",Se,[ce(s("input",{type:"checkbox",id:"selectAllServices","onUpdate:modelValue":e[1]||(e[1]=t=>k.value=t),onChange:Y,class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,544),[[ue,k.value]]),e[3]||(e[3]=s("label",{for:"selectAllServices",class:"ml-2 text-sm text-gray-700"},"Select All Available",-1))])):B("",!0)]),s("table",Ee,[e[6]||(e[6]=s("thead",{class:"bg-gray-50"},[s("tr",null,[s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Select "),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Service Name "),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Price (ETB) "),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status ")])],-1)),s("tbody",ke,[(i(!0),l(N,null,T(M.value,t=>{var n;return i(),l("tr",{key:t.contractDetailUuid,class:I({"bg-blue-50":t.isExisting,"hover:bg-gray-50":!t.isExisting})},[s("td",De,[s("input",{type:"checkbox",checked:Q(t),onChange:u=>J(t),disabled:t.isExisting,class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,40,Ue)]),s("td",Ce,v(t.serviceName||"N/A"),1),s("td",Ae,v(((n=t.negotiatedPrice)==null?void 0:n.toLocaleString("en-US",{minimumFractionDigits:2}))||"0.00"),1),s("td",Ne,[t.isExisting?(i(),l("span",Te," Already in contract ")):(i(),l("span",Ie," Available "))])],2)}),128)),M.value.length===0?(i(),l("tr",Be,e[5]||(e[5]=[s("td",{colspan:"4",class:"px-6 py-4 text-center text-sm text-gray-500"}," No services found matching your search ",-1)]))):B("",!0)])])])):(i(),l("div",Fe,[s("table",Re,[e[8]||(e[8]=s("thead",{class:"bg-gray-50"},[s("tr",null,[s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Select "),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Drug Name "),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Price (ETB) "),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status ")])],-1)),s("tbody",Ve,[(i(!0),l(N,null,T(L.value,t=>{var n;return i(),l("tr",{key:t.contractDetailUuid,class:I({"bg-blue-50":t.isExisting,"hover:bg-gray-50":!t.isExisting})},[s("td",Me,[s("input",{type:"checkbox",checked:W(t),onChange:u=>K(t),disabled:t.isExisting,class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,40,Le)]),s("td",Pe,v(t.drugName||"N/A"),1),s("td",He,v(((n=t.negotiatedPrice)==null?void 0:n.toLocaleString("en-US",{minimumFractionDigits:2}))||"0.00"),1),s("td",je,[t.isExisting?(i(),l("span",$e," Already in contract ")):(i(),l("span",ze," Available "))])],2)}),128)),L.value.length===0?(i(),l("tr",Ge,e[7]||(e[7]=[s("td",{colspan:"4",class:"px-6 py-4 text-center text-sm text-gray-500"}," No drugs found matching your search ",-1)]))):B("",!0)])])])),s("div",qe,[h(H,{onClick:j(F),variant:"outline"},{default:D(()=>e[9]||(e[9]=[$(" Cancel ")])),_:1,__:[9]},8,["onClick"]),h(H,{onClick:X,pending:j(G).pending.value,class:"text-white py-4 bg-primary",disabled:(r.value.length===0||r.value.every(t=>t.isExisting))&&(c.value.length===0||c.value.every(t=>t.isExisting))},{default:D(()=>[$(" Add Selected "+v(g.value===0?"Services":"Drugs"),1)]),_:1},8,["pending","disabled"])])])]),_:1})]),_:1}))}},Je=ee(Oe,[["__scopeId","data-v-0427778b"]]);export{Je as default};
